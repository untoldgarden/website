<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="assets/main.css">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, touch-action=manipulation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Untold Garden</title>
    <meta name="author" content="Untold Garden">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="{{ site.baseurl }}/favicon.ico">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Untold Garden is an art and design studio exploring new technologies. Their works include physical installations, virtual sculptures, interactive performances, artificial natures and experimental social networks.">    
    <link rel="canonical" href="{{ site.url }}{{ page.url | remove: 'index.html' }}" />
    <meta name="keywords" content="untold garden, studio, collective, art, contemporary art, sculpture, public art, participatory art, vr, ar, xr, virtual reality, augmented reality, spatial computing, meadow, max celar, max čelar, jakob skote, micheal brewster, design, experiential art, spatial design, research">
    <meta name="geo.region" content="GB" />
    <meta name="geo.region" content="SE" />
    <meta name="geo.placename" content="United Kingdom" />
    <meta name="geo.placename" content="Sweden" />
    <link rel="alternate" hreflang="en-gb" href="{{ site.url }}{{ page.url | remove: 'index.html' }}" />
    <link rel="alternate" hreflang="en-se" href="{{ site.url }}{{ page.url | remove: 'index.html' }}" />
    <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.url | remove: 'index.html' }}" />
    
    <!-- Enhanced Open Graph -->
    <meta property="og:title" content="{% if page.title %}{{ page.title }} | Untold Garden{% else %}Untold Garden - Art & Design Studio{% endif %}" />
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% else %}Untold Garden is an art and design studio exploring new technologies. Their works include physical installations, virtual sculptures, interactive performances, artificial natures and experimental social networks.{% endif %}" />
    <meta property="og:url" content="{{ site.url }}{{ page.url | remove: 'index.html' }}" />
    <meta property="og:site_name" content="Untold Garden" />
    <meta property="og:type" content="{% if page.layout == 'project' %}article{% else %}website{% endif %}" />
    <meta property="og:image" content="{{ site.url }}/assets/images/{% if page.image %}{{ page.image }}{% else %}reach.webp{% endif %}" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1080" />
    <meta property="og:locale" content="en_US" />

    <!-- Enhanced Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@untoldgarden" />
    <meta name="twitter:creator" content="@untoldgarden" />
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }} | Untold Garden{% else %}Untold Garden - Art & Design Studio{% endif %}" />
    <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% else %}Untold Garden is an art and design studio exploring new technologies. Their works include physical installations, virtual sculptures, interactive performances, artificial natures and experimental social networks.{% endif %}" />
    <meta name="twitter:image" content="{{ site.url }}/assets/images/{% if page.image %}{{ page.image }}{% else %}reach.webp{% endif %}" />

    <!-- Additional SEO Meta Tags -->
    <meta property="article:author" content="Untold Garden" />
    <meta property="article:publisher" content="https://untold.garden" />
    <meta name="application-name" content="Untold Garden" />
    <meta name="apple-mobile-web-app-title" content="Untold Garden" />
    
    <!-- Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Untold Garden",
      "alternateName": ["Untold Garden Studio", "Untold Garden Collective"],
      "url": "{{ site.url }}",
      "logo": "{{ site.url }}/assets/images/reach.webp",
      "description": "Untold Garden is an art and design studio exploring new technologies. Their works include physical installations, virtual sculptures, interactive performances, artificial natures and experimental social networks.",
      "foundingDate": "2020",
      "areaServed": ["GB", "SE", "United Kingdom", "Sweden"],
      "knowsAbout": ["Contemporary Art", "Public Art", "Participatory Art", "Virtual Reality", "Augmented Reality", "Spatial Computing", "Experiential Art", "Spatial Design", "Research"],
      "founder": [
        {
          "@type": "Person",
          "name": "Max Čelar",
          "alternateName": "Max Celar"
        },
        {
          "@type": "Person", 
          "name": "Jakob Skote"
        },
        {
          "@type": "Person",
          "name": "Micheal Brewster"
        }
      ],
      "sameAs": [
        "https://twitter.com/untoldgarden",
        "https://www.instagram.com/untoldgarden",
        "https://uk.linkedin.com/company/untoldgarden",
        "https://news.untold.garden"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "General Inquiries",
        "url": "{{ site.url }}/about-us/"
      }
    }
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8EXHG4515Q"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-8EXHG4515Q');
    </script>

    <!-- Preload critical resources -->
    <link rel="preload" href="https://player.vimeo.com/api/player.js" as="script">
    <link rel="preload" href="{{ site.baseurl }}/assets/main.css" as="style">
    <link rel="preload" href="{{ site.baseurl }}/assets/images/fallback-bg.webp" as="image">
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//player.vimeo.com">
    <link rel="dns-prefetch" href="//vimeo.com">
    <link rel="dns-prefetch" href="//www.googletagmanager.com">
    
    <!-- Sitemap and RSS -->
    <link rel="sitemap" type="application/xml" href="{{ site.url }}/sitemap.xml">
    {% feed_meta %}

    <style>
        /* Force full screen on iOS */
        html {
            background-color: #000 !important;
        }
        
        body {
            background-color: #000 !important;
            font-family: 'Kievit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
        }
        
        * {
            font-family: 'Kievit', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif !important;
        }
        
        #background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            z-index: 1;
            background: url('{{ site.baseurl }}/assets/images/fallback-bg.webp') no-repeat center center;
            background-size: cover;
            background-color: #000;
            pointer-events: none;
        }

        @media screen and (max-width: 767px) {
            #background-container {
                background: url('{{ site.baseurl }}/assets/images/fallback-bkg-mobile.webp') no-repeat center center;
                background-size: cover;
                background-color: #000;
            }
        }

        #video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.3s ease-in;
            pointer-events: none;
            background-color: #000;
            z-index: 2;
        }
        
        @supports (-webkit-touch-callout: none) {
            /* iOS specific - scale to cover bottom bar */
            #video-background {
                width: 100vw;
                height: 100vh;
            }
        }
        
        #video-background iframe {
            position: absolute !important;
            top: 0 !important;
            left: 50% !important;
            width: 177.78vh !important;
            height: 100vh !important;
            min-width: 100vw !important;
            min-height: 100vh !important;
            transform: translateX(-50%) !important;
            border: none !important;
        }
        
        #video-background.mobile-embed iframe {
            position: absolute !important;
            top: 0 !important;
            left: 50% !important;
            width: 177.78vh !important;
            height: 100vh !important;
            min-width: 100vw !important;
            min-height: 100vh !important;
            transform: translateX(-50%) !important;
        }

        @media (max-width: 767px) {
            #video-background {
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
            }
            
            #video-background iframe {
                position: absolute !important;
                top: 0 !important;
                left: 50% !important;
                width: 177.78vh !important;
                height: 100vh !important;
                min-width: 100vw !important;
                min-height: 100vh !important;
                transform: translateX(-50%) !important;
                border: none !important;
            }
        }

        .header {
            position: relative;
            z-index: 100;
            pointer-events: auto;
        }
        
        .header * {
            pointer-events: auto;
        }
        
        .logo, .navigation, .navigation a {
            color: #fafafa !important;
            opacity: 1 !important;
            visibility: visible !important;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.3);
        }
        
        .navigation a {
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            body {
                padding-top: env(safe-area-inset-top);
            }
            
            .header {
                position: fixed !important;
                top: auto !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                padding: 0 !important;
                flex-direction: row !important;
                align-items: stretch !important;
                background: transparent !important;
                padding-bottom: env(safe-area-inset-bottom) !important;
            }
            
            .logo {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                display: block !important;
                padding: 20px 25px !important;
                padding-top: max(20px, calc(env(safe-area-inset-top) + 10px)) !important;
                font-size: 1.2em !important;
            }
            
            .navigation {
                flex-direction: row !important;
                width: 100% !important;
                margin: 0 !important;
                gap: 0 !important;
            }
            
            .navigation a {
                flex: 1 !important;
                text-align: center !important;
                padding: 40px 10px 10px 10px !important;
                position: relative !important;
                font-size: 0.9em !important;
            }
            
            .navigation a::after {
                content: '' !important;
                position: absolute !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 1px !important;
                height: 55% !important;
                background: rgba(255, 255, 255, 0.3) !important;
            }
            
            .navigation a:last-child::after {
                display: none !important;
            }
        }
        
        #video-background.loaded {
            opacity: 1;
        }
        
        #video-background.mobile-embed {
            background-color: #000;
        }

        #video-background.mobile-embed iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>

<body>
    <div id="background-container"></div>
    <div id="video-background"></div>

    <script src="https://player.vimeo.com/api/player.js"></script>
    <script>
        (function() {
            const DESKTOP_VIDEO_URL = 'https://player.vimeo.com/video/1047666931?h=e9bd2fa0b0';
            const MOBILE_VIDEO_URL = 'https://player.vimeo.com/video/1061053405?h=3faa6f7993';
            const mobileBreakpoint = window.matchMedia('(max-width: 767px)');
            const coarsePointerQuery = window.matchMedia('(pointer: coarse)');
            const videoBackground = document.getElementById('video-background');
            const isMobileUserAgent = /Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent || '');
            let player = null;
            let currentVariant = null;
            let playerQueue = Promise.resolve();
            let isInitialized = false;

            const shouldUseMobileVideo = () => {
                if (mobileBreakpoint.matches) {
                    return true;
                }

                if (coarsePointerQuery.media && coarsePointerQuery.media !== 'not all' && coarsePointerQuery.matches) {
                    return true;
                }

                if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
                    return true;
                }

                if (isMobileUserAgent) {
                    return true;
                }

                return false;
            };

            const destroyPlayer = () => {
                if (!player) {
                    return Promise.resolve();
                }

                const existing = player;
                player = null;
                return existing.destroy().catch(function (error) {
                    console.log('Vimeo destroy failed:', error);
                });
            };

            const createPlayer = (variant) => {
                const options = variant === 'mobile'
                    ? {
                        url: MOBILE_VIDEO_URL,
                        loop: true,
                        autoplay: true,
                        background: false,
                        controls: false,
                        byline: false,
                        title: false,
                        dnt: true,
                        muted: true,
                        autopause: false,
                        pip: false,
                        playsinline: true,
                        responsive: true
                    }
                    : {
                        url: DESKTOP_VIDEO_URL,
                        loop: true,
                        autoplay: true,
                        background: true,
                        muted: true,
                        byline: false,
                        title: false,
                        quality: 'auto',
                        responsive: true,
                        speed: true,
                        pip: false,
                        controls: false
                    };

                videoBackground.classList.toggle('mobile-embed', variant === 'mobile');
                videoBackground.classList.remove('loaded');
                videoBackground.innerHTML = '';

                try {
                    player = new Vimeo.Player('video-background', options);
                } catch (error) {
                    console.log('Failed to create Vimeo player:', error);
                    player = null;
                    return;
                }

                player.setVolume(0);

                player.on('play', function () {
                    videoBackground.classList.add('loaded');
                });

                player.ready().then(function() {
                    player.play().catch(function (error) {
                        console.log('Autoplay failed:', error);
                    });
                });

                player.on('error', function (error) {
                    console.log('Vimeo error:', error);
                });
            };

            const ensurePlayer = (variant) => {
                if (variant === currentVariant && player) {
                    return;
                }

                currentVariant = variant;
                playerQueue = playerQueue
                    .then(destroyPlayer)
                    .then(function () {
                        console.log('Switching background video to', variant, 'variant');
                        createPlayer(variant);
                    })
                    .catch(function (error) {
                        console.log('Vimeo init failed:', error);
                    });
            };

            const evaluateVariant = () => {
                const variant = shouldUseMobileVideo() ? 'mobile' : 'desktop';
                ensurePlayer(variant);
            };

            const initialize = () => {
                if (isInitialized) return;
                isInitialized = true;
                evaluateVariant();
            };

            // Initialize on DOM ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initialize);
            } else {
                initialize();
            }

            // Reinitialize on page visibility change (handles back button)
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && videoBackground) {
                    isInitialized = false;
                    initialize();
                }
            });

            // Handle page show event (bfcache)
            window.addEventListener('pageshow', function(event) {
                if (event.persisted) {
                    isInitialized = false;
                    initialize();
                }
            });

            const addChangeListener = (mediaQueryList, handler) => {
                if (!mediaQueryList) {
                    return;
                }

                if (typeof mediaQueryList.addEventListener === 'function') {
                    mediaQueryList.addEventListener('change', handler);
                } else if (typeof mediaQueryList.addListener === 'function') {
                    mediaQueryList.addListener(handler);
                }
            };

            addChangeListener(mobileBreakpoint, evaluateVariant);
            addChangeListener(coarsePointerQuery, evaluateVariant);

            window.addEventListener('orientationchange', evaluateVariant);
            window.addEventListener('resize', evaluateVariant);
        })();
    </script>

    <div class="header">
        <div class="logo">
            Untold Garden
        </div>
        <div class="navigation">
            <a href="{{ '/projects/' | relative_url }}">Projects</a>
            <a href="https://news.untold.garden">News</a>
            <a href="{{ '/about-us/' | relative_url }}">About Us</a>
        </div>
    </div>
</body>

</html>
